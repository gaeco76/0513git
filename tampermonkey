// ==UserScript==
// @name         셀 숫자 추출 및 우측 입력창 자동 입력
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  특정 셀에서 숫자를 추출해 우측 입력창에 자동 입력하고, 입력창으로 셀에 결과 입력
// @match        *://*/*
// @grant        GM_setClipboard
// ==/UserScript==

(function() {
    'use strict';

    // 우측 고정 패널 생성
    const panel = document.createElement("div");
    panel.style.position = "fixed";
    panel.style.top = "10%";
    panel.style.right = "0";
    panel.style.width = "20%";
    panel.style.height = "80%";
    panel.style.padding = "16px";
    panel.style.background = "#f9f9f9";
    panel.style.borderRadius = "16px 0 0 16px";
    panel.style.boxShadow = "0 0 10px rgba(0,0,0,0.1)";
    panel.style.display = "flex";
    panel.style.flexDirection = "column";
    panel.style.justifyContent = "flex-start";
    panel.style.zIndex = "9999";
    document.body.appendChild(panel);

    // 숫자 입력창 생성
    const input1 = document.createElement("input");
    input1.type = "number";
    input1.style.margin = "8px 0";
    input1.style.padding = "10px";
    input1.style.borderRadius = "10px";
    input1.style.border = "1px solid #ccc";
    input1.style.fontSize = "14px";
    panel.appendChild(input1);

    // 드롭다운 선택창 생성
    const select = document.createElement("select");
    select.style.margin = "8px 0";
    select.style.padding = "10px";
    select.style.borderRadius = "10px";
    select.style.border = "1px solid #ccc";
    select.style.fontSize = "14px";
    ["목록은", "숫자는"].forEach(text => {
        const opt = document.createElement("option");
        opt.value = text;
        opt.textContent = `${text} 개입니다.`;
        select.appendChild(opt);
    });
    panel.appendChild(select);

    // 출력 라벨 생성
    const label = document.createElement("div");
    label.style.margin = "8px 0";
    label.style.fontSize = "16px";
    label.style.fontWeight = "bold";
    panel.appendChild(label);

    // 버튼 생성
    const btn = document.createElement("button");
    btn.textContent = "좌측에 붙여넣기";
    btn.style.margin = "8px 0";
    btn.style.padding = "10px";
    btn.style.borderRadius = "10px";
    btn.style.border = "none";
    btn.style.backgroundColor = "#4CAF50";
    btn.style.color = "white";
    btn.style.cursor = "pointer";
    panel.appendChild(btn);

    // 테이블 셀에서 숫자 추출 후 입력창에 자동 입력
    const targetCell = document.querySelector("#select") || document.querySelector('[id*="select"]');
    if (targetCell) {
        const textContent = targetCell.textContent.trim();
        const match = textContent.match(/\d{1,3}/);
        if (match) {
            const number = match[0];
            input1.value = number; // 숫자를 입력창에 자동 입력
            GM_setClipboard(number); // 클립보드에 숫자 복사
            updateLabel(); // 라벨 즉시 업데이트
        }
    }

    // 입력 후 엔터로 드롭다운으로 이동
    input1.addEventListener("keydown", function(e) {
        if (e.key === "Enter") {
            select.focus();
        }
    });

    // 입력값과 드롭다운 선택값으로 라벨 업데이트
    function updateLabel() {
        const num = input1.value;
        const txt = select.value;
        if (num) {
            label.textContent = `${txt} ${num}개입니다.`;
        } else {
            label.textContent = "";
        }
    }

    // 입력창과 드롭다운 변경 시 라벨 업데이트
    input1.addEventListener("input", updateLabel);
    select.addEventListener("change", updateLabel);

    // 버튼 클릭 시 특정 셀에 텍스트 입력 후 버튼 클릭
    btn.addEventListener("click", function() {
        const labelText = label.textContent;
        const targetCell = document.querySelector("#query") || document.querySelector('[id*="query"]');
        const targetBtn = document.querySelector("#btn") || document.querySelector('[id*="btn"]');
        
        if (targetCell && targetBtn && labelText) {
            if (targetCell.tagName === 'INPUT' || targetCell.tagName === 'TEXTAREA') {
                targetCell.value = labelText; // 텍스트를 입력 필드에 입력
                targetCell.dispatchEvent(new Event('input', { bubbles: true })); // 입력 이벤트 발생
            } else {
                targetCell.textContent = labelText; // 텍스트를 요소에 입력
            }
            targetBtn.click(); // 버튼 클릭
        }
    });
})();